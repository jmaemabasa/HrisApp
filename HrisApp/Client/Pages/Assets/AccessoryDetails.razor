@page "/asset-accessories/details/{id:int}"
@attribute [Authorize(Roles = "CadAdmin, SysAdmin, GenAdmin, Technical")]
<PageTitle>Asset Details</PageTitle>


<MudGrid Spacing="3">
    <MudItem xs="12" lg="3">
        <div class="mainassleft" style="margin-top: 10px;">
            <div class="d-flex flex-column justify-content-center ">
                <div class="d-flex justify-content-between align-items-center">
                    <span class="spantitle">Asset Accessory</span>
                </div>
                <div class="d-flex flex-column gap-2" style="margin-top: 1rem;">
                    <div class="d-flex justify-content-center">
                        <div class="asset-img">
                            <img class="asset-img-img" alt="asset image" src="@AccessImageData" />
                        </div>
                    </div>
                    <div>
                        <div class="d-flex justify-content-center">
                            <span class="asset-code">@obj.AssetCode</span>
                        </div>
                        <div class="d-flex justify-content-center">
                            @if (obj.AssetStatusId == 2)
                            {
                                <MudChip Style="background: #ced1d4; color: #515254; font-weight: bold;font-size: 11px;margin-bottom: 10px;">@obj.AssetStatus?.Name</MudChip>
                            }
                            else if (obj.AssetStatusId == 3)
                            {
                                <MudChip Style="background: #D8D5E8; color: #7567B8; font-weight: bold;font-size: 11px;margin-bottom: 10px;">@obj.AssetStatus?.Name</MudChip>
                            }
                            else if (obj.AssetStatusId == 4)
                            {
                                <MudChip Style="background: #9caac1; color: #38465e; font-weight: bold;font-size: 11px;margin-bottom: 10px;">@obj.AssetStatus?.Name</MudChip>
                            }
                            else if (obj.AssetStatusId == 5)
                            {
                                <MudChip Style="background: #f5dfa4; color: #e38d0f; font-weight: bold;font-size: 11px;margin-bottom: 10px;">@obj.AssetStatus?.Name</MudChip>
                            }
                            else if (obj.AssetStatusId == 6)
                            {
                                <MudChip Style="background: #EABCBB; color: #be1313; font-weight: bold;font-size: 11px;margin-bottom: 10px;">@obj.AssetStatus?.Name</MudChip>
                            }
                            else
                            {
                                <MudChip Style="background: #C1D4CD; color: #397763; font-weight: bold;font-size: 11px;margin-bottom: 10px;">@obj.AssetStatus?.Name</MudChip>
                            }
                        </div>
                    </div>

                    <div class="divsingledetails">
                        <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Type</MudText>
                        <MudText Align="Align.Start" Style="color: #757A90; font-weight:bold;" Typo="Typo.body2">@obj.Type?.AType_Name</MudText>
                    </div>
                    <div class="divsingledetails">
                        <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Category</MudText>
                        <MudText Align="Align.Start" Style="color: #757A90; font-weight:bold;" Typo="Typo.body2">@obj.Category?.ACat_Name</MudText>
                    </div>
                    <div class="divsingledetails">
                        <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Sub Category</MudText>
                        <MudText Align="Align.Start" Style="color: #757A90; font-weight:bold;" Typo="Typo.body2">@obj.SubCategory?.ASubCat_Name</MudText>
                    </div>
                    @if (obj.MainAsset?.EmployeeId != null)
                    {
                        <div class="divsingledetails">
                            <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Currently Assigned To</MudText>

                            <div style="margin-top: 10px;">
                                <EmployeeNamePosition verify="@EMPLOYEE.Where(e => e.Id == obj.MainAsset?.EmployeeId).FirstOrDefault()!.Verify_Id" />
                            </div>
                        </div>
                    }
                    <div class="divsingledetails">
                        <div class="d-flex align-items-center">
                            <div class="flex-grow-1">
                                <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Last Check On</MudText>
                                @if (obj.LastCheckDate == null)
                                {
                                    <MudText Align="Align.Start" Style="color: #757A90; font-weight:bold;font-style:italic" Typo="Typo.body2">
                                        Not checked yet.
                                    </MudText>
                                }
                                else
                                {
                                    <MudText Align="Align.Start" Style="color: #757A90; font-weight:bold;" Typo="Typo.body2">@obj.LastCheckDate?.ToString("MMM dd yyyy")</MudText>
                                }
                            </div>
                            <div>
                                <MudIconButton OnClick="@(() => OpenDrawer(Anchor.End, "lastCheckOpen"))" Icon="@Icons.Material.Filled.TipsAndUpdates" Style="color: #757A90" />
                            </div>
                        </div>
                    </div>

                    <div class="divsingledetails">
                        <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Created By</MudText>
                        <AssetCreatedBy Id="@obj.CreatedById" />
                    </div>
                </div>
            </div>
        </div>
    </MudItem>
    <MudItem xs="12" lg="9">
        <div class="mainassmain">
            <MudTabs Elevation="0" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-5" @ref="Tabs" @bind-ActivePanelIndex="activeIndex">
                <MudTabPanel TabContent="TabHeader(0)">
                    <div class="mainasssec">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span class="spantitle">Accessory</span>
                            <AuthorizeView Roles="CadAdmin, SysAdmin, GenAdmin,Technical">
                                <Authorized>
                                    <button class="Btn" onclick="@(() => OpenDrawer(Anchor.End, "leftPanelOpen"))">
                                        <div class="sign"><MudIcon Icon="@Icons.Material.Rounded.Edit"></MudIcon></div>
                                        <div class="text">Update</div>
                                    </button>
                                </Authorized>
                            </AuthorizeView>
                        </div>
                        <MudGrid>
                            <MudItem xs="12" sm="10">
                                <MudGrid Spacing="2" Class="detailsgrid">
                                    <MudItem xs="12" sm="6">
                                        <div class="divsingledetails">
                                            <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Asset</MudText>
                                            <MudText Align="Align.Start" Style="color: #27374D; font-weight:bold;" Typo="Typo.body2">@obj.AssetCode</MudText>
                                        </div>
                                    </MudItem>

                                    <MudItem xs="12" sm="6">
                                        <div class="divsingledetails">
                                            <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Type</MudText>
                                            <MudText Align="Align.Start" Style="color: #757A90; font-weight:bold;" Typo="Typo.body2">@obj.Type?.AType_Name</MudText>
                                        </div>
                                    </MudItem>
                                    <MudItem xs="12" sm="6">
                                        <div class="divsingledetails">
                                            <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Category</MudText>
                                            <MudText Align="Align.Start" Style="color: #757A90; font-weight:bold;" Typo="Typo.body2">@obj.Category?.ACat_Name</MudText>
                                        </div>
                                    </MudItem>
                                    <MudItem xs="12" sm="6">
                                        <div class="divsingledetails">
                                            <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Sub Category</MudText>
                                            <MudText Align="Align.Start" Style="color: #757A90; font-weight:bold;" Typo="Typo.body2">@obj.SubCategory?.ASubCat_Name</MudText>
                                        </div>
                                    </MudItem>

                                    <MudItem xs="12" sm="4">
                                        <div class="divsingledetails">
                                            <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Purchase Date</MudText>
                                            <MudText Align="Align.Start" Style="color: #757A90; font-weight:bold;" Typo="Typo.body2">@obj.PurchaseDate?.ToString("MMM dd yyyy")</MudText>
                                        </div>
                                    </MudItem>
                                    <MudItem xs="12" sm="4">
                                        <div class="divsingledetails">
                                            <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Purchase Amount</MudText>
                                            <MudText Align="Align.Start" Style="color: #757A90; font-weight:bold;" Typo="Typo.body2">@obj.PurchaseAmount</MudText>
                                        </div>
                                    </MudItem>
                                    <MudItem xs="12" sm="4">
                                        <div class="divsingledetails">
                                            <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">End of Useful Life (Months)</MudText>
                                            @{
                                                int eufMonths = 0;
                                                if (!string.IsNullOrEmpty(obj.EUF) && int.TryParse(obj.EUF, out eufMonths))
                                                {
                                                    var isEuf = obj.PurchaseDate.HasValue && DateTime.Today > obj.PurchaseDate.Value.AddMonths(eufMonths);
                                                    if (isEuf)
                                                    {
                                                        <MudText Align="Align.Start" Style="color: #be1313; font-weight:bold;" Typo="Typo.body2">@eufMonths Months</MudText>
                                                    }
                                                    else
                                                    {
                                                        <MudText Align="Align.Start" Style="color: #757A90; font-weight:bold;" Typo="Typo.body2">@eufMonths Months</MudText>
                                                    }
                                                }
                                                else
                                                {
                                                    <MudText Align="Align.Start" Style="color: #757A90; font-weight:bold;" Typo="Typo.body2">0 Months</MudText>
                                                }
                                            }
                                        </div>
                                    </MudItem>
                                </MudGrid>
                            </MudItem>
                            <MudItem xs="12" sm="2">
                                <div class="d-flex flex-column">
                                    <div>
                                        <img class="qrimage" src="@QRIMAGE" alt="QR Code" style="width: 100%;height: 153px; border-radius: 10px;" />
                                    </div>
                                    <div>
                                        <MudButton Class="btn btnpritnQR" FullWidth="true" OnClick="PrintQR">
                                            @if (isLoadingPrintQR)
                                            {
                                                <MudProgressCircular Color="Color.Warning" Size="Size.Small" Indeterminate="true" /> <span class="ms-2">Please Wait..</span>
                                            }
                                            else
                                            {
                                                <span>Print QR</span>
                                            }
                                        </MudButton>
                                    </div>
                                </div>
                            </MudItem>
                        </MudGrid>
                    </div>
                    <div class="mainasssec" style="margin-top: 25px;">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span class="spantitle">Additional Details</span>
                            <AuthorizeView Roles="CadAdmin, SysAdmin, GenAdmin,Technical">
                                <Authorized>
                                    <button class="Btn" onclick="@(() => OpenDrawer(Anchor.End, "detailsPanelOpen"))">
                                        <div class="sign"><MudIcon Icon="@Icons.Material.Rounded.Edit"></MudIcon></div>
                                        <div class="text">Update</div>
                                    </button>
                                </Authorized>
                            </AuthorizeView>
                        </div>
                        <div class="d-flex flex-column gap-3">
                            <div class="d-flex flex-row gap-4">
                                <MudItem xs="12" Class="divsingledetails">
                                    <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Name</MudText>
                                    <MudText Align="Align.Start" Style="color: #757A90; font-weight:bold;" Typo="Typo.body2">@obj.Name</MudText>
                                </MudItem>
                            </div>
                            <div class="d-flex flex-row gap-4">
                                <MudItem xs="12" Class="divsingledetails">
                                    <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Description</MudText>
                                    <MudText Align="Align.Start" Style="color: #757A90; font-weight:bold;" Typo="Typo.body2">@obj.Description</MudText>
                                </MudItem>
                            </div>
                            <div class="d-flex flex-row gap-4">
                                <MudItem xs="12" sm="6" Class="divsingledetails">
                                    <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Brand</MudText>
                                    <MudText Align="Align.Start" Style="color: #757A90; font-weight:bold;" Typo="Typo.body2">@obj.Brand</MudText>
                                </MudItem>
                                <MudItem xs="12" sm="6" Class="divsingledetails">
                                    <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Model</MudText>
                                    <MudText Align="Align.Start" Style="color: #757A90; font-weight:bold;" Typo="Typo.body2">@obj.Model</MudText>
                                </MudItem>
                            </div>
                            <div class="d-flex flex-row gap-4">
                                <MudItem xs="12" Class="divsingledetails">
                                    <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Quantity</MudText>
                                    <MudText Align="Align.Start" Style="color: #757A90; font-weight:bold;" Typo="Typo.body2">@obj.Quantity</MudText>
                                </MudItem>
                            </div>
                            @* <div class="d-flex flex-row gap-4">
                            <MudItem xs="12" Class="divsingledetails">
                            <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Serial</MudText>
                            <MudText Align="Align.Start" Style="color: #27374D; font-weight:bold;" Typo="Typo.body2">@obj.Serial</MudText>
                            </MudItem>
                            </div> *@
                            <div class="d-flex flex-row gap-4">
                                <MudItem xs="12" Class="divsingledetails">
                                    <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Remarks</MudText>
                                    @* <MudText Align="Align.Start" Style="color: #757A90; font-weight:bold;" Typo="Typo.body2">@obj.Remarks</MudText> *@
                                    <div class="d-flex flex-wrap">
                                        @if (REMARKS.Count != 0)
                                        {
                                            @foreach (var item in REMARKS)
                                            {
                                                <MudChip Text="orange" Variant="Variant.Filled" Style="color: #4b4e5c; background-color: rgba(117, 122, 144,.1);">@item.Remark</MudChip>
                                            }
                                        }
                                        else
                                        {
                                            <span style="font-weight: bold;color: #fafaf5">No Information</span>
                                        }
                                    </div>
                                </MudItem>
                            </div>
                        </div>
                    </div>
                </MudTabPanel>
                <MudTabPanel TabContent="TabHeader(1)">
                    <div class="mainasssec">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span class="spantitle">Currently Assigned To</span>
                            @if (obj.MainAssetId != null)
                            {
                                <MudTooltip Text="Open">
                                    <MudIconButton OnClick="@(() => GlobalConfigService.OpenInNewTab($"main-asset/details/{obj.MainAssetId}"))" Icon="@Icons.Material.Rounded.OpenInNew"></MudIconButton>
                                </MudTooltip>
                            }
                        </div>
                        <div class="container-fluid">
                            <div class="row">
                                @if (obj.MainAssetId == null)
                                {
                                    <span style="font-style: italic;">No main asset assigned</span>
                                }
                                else
                                {
                                    <div class="col d-flex gap-3 flex-wrap">
                                        <div class="d-flex flex-grow-1 flex-column gap-3">
                                            <div class="divsingledetails">
                                                <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Main Asset</MudText>
                                                <MudText Align="Align.Start" Style="color: #757A90; font-weight:bold;" Typo="Typo.body2">@obj.MainAsset?.AssetCode</MudText>
                                            </div>
                                            <div class="divsingledetails">
                                                <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Type / Category / Sub Category</MudText>
                                                <MudText Align="Align.Start" Style="color: #757A90; font-weight:bold;" Typo="Typo.body2">
                                                    @obj.Type?.AType_Name / @obj.Category?.ACat_Name / @obj.SubCategory?.ASubCat_Name
                                                </MudText>
                                            </div>
                                            <div class="divsingledetails">
                                                <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Date Assigned</MudText>
                                                <MudText Align="Align.Start" Style="color: #757A90; font-weight:bold;" Typo="Typo.body2">@obj.MainAssetDateUpdated?.ToString("MMM dd yyyy")</MudText>
                                            </div>
                                        </div>
                                        <div class="col-12 col-md-3">
                                            <img class="emp-img" alt="employee image" src="@MainAssetImage" style="width: 100%; height: 197px; object-fit: cover;" />
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                    <div class="mainasssec" style="margin-top: 25px;padding: 20px 20px 5px 20px;">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span class="spantitle">Assigned History</span>
                        </div>
                        <div class="">
                            @if (ACCHISTORY.Where(e => e.UnassignedDateMainAss != null && e.AssetAccessoryId == obj.Id) == null || ACCHISTORY.Where(e => e.UnassignedDateMainAss != null && e.AssetAccessoryId == obj.Id).ToList().Count == 0)
                            {
                                <div style="font-style: italic;margin-bottom: 20px;">Never been used</div>
                            }
                            else
                            {
                                <MudTable Class="stable" Height="323px" Items="ACCHISTORY.Where(e => e.UnassignedDateMainAss != null && e.AssetAccessoryId == obj.Id)" Context="item" SortLabel="Sort By" FixedHeader="true" Elevation="0" HorizontalScrollbar="true" Dense="true" Hover="true" Bordered="false" Striped="true">
                                    <HeaderContent>
                                        <MudTh Class="" Style="background: #e9ecef; font-weight: bold; font-size: 15px;">Assigned To</MudTh>
                                        <MudTh Class="" Style="background: #e9ecef; font-weight: bold; font-size: 15px;">Employee</MudTh>
                                        <MudTh Class="" Style="background: #e9ecef; font-weight: bold; font-size: 15px;">Assigned Date</MudTh>
                                        <MudTh Class="" Style="background: #e9ecef; font-weight: bold; font-size: 15px;">Unassigned Date</MudTh>
                                    </HeaderContent>
                                    <RowTemplate>
                                        <MudTd DataLabel="Main Asset">@item.MainAsset?.AssetCode</MudTd>
                                        <MudTd DataLabel="Main Asset">
                                            <EmployeeNamePosition verify="@item.Employee?.Verify_Id" />
                                        </MudTd>
                                        <MudTd DataLabel="Assigned Date">@item.AssignedDateMainAss?.ToString("MMM dd yyyy")</MudTd>
                                        <MudTd DataLabel="Unassigned Date">@item.UnassignedDateMainAss?.ToString("MMM dd yyyy")</MudTd>
                                    </RowTemplate>
                                    <PagerContent>
                                        <MudTablePager PageSizeOptions="new int[] { 5, 25, int.MaxValue }" InfoFormat="@($"Right {infoFormat}")" HorizontalAlignment="HorizontalAlignment.Right" />
                                    </PagerContent>
                                </MudTable>
                            }
                        </div>
                    </div>
                </MudTabPanel>
                <MudTabPanel TabContent="TabHeader(2)">
                    <div class="mainasssec" style="padding-bottom: 7px ">
                        <AccessoryMultiImage AccAssetId="@obj.Id" AccAssetCode="@obj.AssetCode" JMCode="@obj.JMCode" Catid="@obj.CategoryId" SubCatid="obj.SubCategoryId" OnFileAdded="@RefreshPdfFileList" />

                        <div class="" Style="margin-top: 1rem;">
                            <MudTable Class="stable" Height="590px" Items="assetImgList" Context="item" SortLabel="Sort By" FixedHeader="true" Elevation="0" HorizontalScrollbar="true" Dense="true" Hover="true" Bordered="false" Striped="true">
                                <HeaderContent>
                                    <MudTh Class="" Style="background: #e9ecef; font-weight: bold; font-size: 15px;"></MudTh>
                                    <MudTh Class="col-4" Style="background: #e9ecef; font-weight: bold; font-size: 15px;">Remarks</MudTh>
                                    <MudTh Class="col-3" Style="background: #e9ecef; font-weight: bold; font-size: 15px;text-align: center">Date Uploaded</MudTh>
                                    <MudTh Class="" Style="background: #e9ecef; font-weight: bold; font-size: 15px;text-align: center">Remove</MudTh>
                                </HeaderContent>
                                <RowTemplate>
                                    <MudTd Style="width: 190px">
                                        <DisplayAccessoryImage filename="@item.Img_Filename" remarks="@item.Remarks" date="@item.Img_Date" />
                                    </MudTd>
                                    <MudTd style="color: #6A707D;font-size: 16px;">@item.Remarks</MudTd>
                                    <MudTd style="color: #6A707D;font-size: 16px;text-align: center">
                                        <span>@item.Img_Date.ToString("MMM dd yyyy")</span> <br /> <span style="font-size: 13px;">@item.Img_Date.ToString("hh:mm tt")</span>
                                    </MudTd>
                                    <MudTd style="text-align: center">
                                        @if (!item.Remarks.Equals("First image uploaded."))
                                        {
                                            <MudTooltip Text="Remove">
                                                <MudIconButton Icon="@Icons.Material.Rounded.Remove" Class="btn assetdelteimg" OnClick="@(() => DeleteAssetImg(@item.Img_Filename, obj.AssetCode))">
                                                </MudIconButton>
                                            </MudTooltip>
                                        }
                                    </MudTd>
                                </RowTemplate>
                                <PagerContent>
                                    <MudTablePager PageSizeOptions="new int[] { 5, 25, int.MaxValue }" InfoFormat="@($"Right {infoFormat}")" HorizontalAlignment="HorizontalAlignment.Right" />
                                </PagerContent>
                            </MudTable>
                        </div>
                    </div>
                </MudTabPanel>
            </MudTabs>
        </div>
    </MudItem>
</MudGrid>

<!-- The Modal -->
<div id="myModal" class="modal">
    <span id="closemodalimg" class="close">&times;</span>
    <img class="modal-content" id="img01">
    <div id="caption"></div>
    <div id="date"></div>
    <div id="datetime"></div>
</div>

<MudDrawer @bind-Open="@leftPanelOpen" Width="500px" Height="100%" Anchor="@anchor" Elevation="1" Variant="@DrawerVariant.Temporary" Style=" margin: 10px;">
    <div class="d-flex flex-column gap-2 drawerdetails">
        <span>Update</span>
        <div class="flex-grow-1">
            <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Asset Code</MudText>
            <MudTextField @bind-Value="obj.AssetCode" ReadOnly Variant="Variant.Outlined" Margin="Margin.Dense" Style="font-weight:bold;" />
        </div>
        <div class="flex-grow-1">
            <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Type</MudText>
            <MudSelect @bind-Value="obj.TypeId" Variant="Variant.Outlined" Margin="Margin.Dense">
                <MudSelectItem Disabled="true" Value="0">Select</MudSelectItem>
                @foreach (var sec in TYPES)
                {
                    <MudSelectItem Value="@sec.Id">@sec.AType_Name</MudSelectItem>
                }
            </MudSelect>
        </div>
        <div class="flex-grow-1">
            <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Category</MudText>
            <MudSelect @bind-Value="obj.CategoryId" Variant="Variant.Outlined" Margin="Margin.Dense">
                <MudSelectItem Disabled="true" Value="0">Select</MudSelectItem>
                @foreach (var sec in CAT)
                {
                    <MudSelectItem Value="@sec.Id">@sec.ACat_Name</MudSelectItem>
                }
            </MudSelect>
        </div>
        <div class="flex-grow-1">
            <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Sub Category</MudText>
            <MudSelect @bind-Value="obj.SubCategoryId" Variant="Variant.Outlined" Margin="Margin.Dense">
                <MudSelectItem Disabled="true" Value="0">Select</MudSelectItem>
                @foreach (var sec in SUBCAT.Where(e => e.CategoryId == obj.CategoryId))
                {
                    <MudSelectItem Value="@sec.Id">@sec.ASubCat_Name</MudSelectItem>
                }
            </MudSelect>
        </div>
        <div class="flex-grow-1">
            <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Purchase Date</MudText>
            <MudDatePicker Editable="true" @bind-Date="obj.PurchaseDate" Mask="@(new DateMask("MM/dd/yyyy"))" DateFormat="MM/dd/yyyy" Variant="Variant.Outlined" Margin="Margin.Dense" />
        </div>
        <div class="flex-grow-1">
            <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Purchase Amount</MudText>
            <MudTextField @bind-Value="obj.PurchaseAmount" Mask="@currMask" Variant="Variant.Outlined" Margin="Margin.Dense" Style="margin-bottom: 5px;" />
        </div>
        <div class="flex-grow-1">
            <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">End of Useful Life (Months)</MudText>
            <MudTextField @bind-Value="obj.EUF" Mask="@(new PatternMask("00000"))" Variant="Variant.Outlined" Margin="Margin.Dense" Style="margin-bottom: 5px;" />
        </div>
        <div class="flex-grow-1">
            <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Status</MudText>
            <MudSelect @bind-Value="obj.AssetStatusId" Variant="Variant.Outlined" Margin="Margin.Dense">
                <MudSelectItem Disabled="true" Value="0">Select</MudSelectItem>
                @foreach (var sec in STATUS)
                {
                    <MudSelectItem Value="@sec.Id">@sec.Name</MudSelectItem>
                }
            </MudSelect>
        </div>
        @if (obj.AssetStatusId != 1 && obj.AssetStatusId != 2)
        {
            <div class="flex-grow-1">
                <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">
                    @{
                        var tes = STATUS.Where(e => e.Id == obj.AssetStatusId).FirstOrDefault();
                    }
                    @tes?.Name DATE
                </MudText>
                <MudDatePicker Editable="true" @bind-Date="obj.StatusDate" Mask="@(new DateMask("MM/dd/yyyy"))" DateFormat="MM/dd/yyyy" Variant="Variant.Outlined" Margin="Margin.Dense" />
            </div>
        }
        <div class="d-flex justify-content-center">
            <button type="button" class="btn btn-save" @onclick="SaveUpdate">Save</button>
        </div>
    </div>
</MudDrawer>

<MudDrawer @bind-Open="@detailsPanelOpen" Width="500px" Height="100%" Anchor="@anchor" Elevation="1" Variant="@DrawerVariant.Temporary" Style=" margin: 10px;">
    <div class="d-flex flex-column gap-2 drawerdetails">
        <span>Update</span>
        <div class="flex-grow-1">
            <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Name</MudText>
            <MudTextField @bind-Value="obj.Name" Variant="Variant.Outlined" Margin="Margin.Dense" />
        </div>
        <div class="flex-grow-1">
            <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Description</MudText>
            <MudTextField @bind-Value="obj.Description" Variant="Variant.Outlined" Margin="Margin.Dense" />
        </div>
        <div class="row">
            <div class="col-12 col-lg-6">
                <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Brand</MudText>
                <MudTextField @bind-Value="obj.Brand" Variant="Variant.Outlined" Margin="Margin.Dense" />
            </div>
            <div class="col-12 col-lg-6">
                <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Model</MudText>
                <MudTextField @bind-Value="obj.Model" Variant="Variant.Outlined" Margin="Margin.Dense" />
            </div>
        </div>

        <div class="flex-grow-1">
            <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Quantity</MudText>
            <MudTextField @bind-Value="obj.Quantity" Mask="@(new PatternMask("000000000"))" Variant="Variant.Outlined" Margin="Margin.Dense" />
        </div>
        <div class="flex-grow-1">
            <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Serial</MudText>
            <MudTextField @bind-Value="obj.Serial" Variant="Variant.Outlined" Margin="Margin.Dense" />
        </div>
        <div class="flex-grow-1">
            <div class="d-flex flex-column" style="margin-bottom: 10px;">
                <div class="flex-grow-1">
                    <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Remarks</MudText>
                    <div class="d-flex">
                        <MudTextField @bind-Value="newRemark" Variant="Variant.Outlined" Margin="Margin.Dense" Style="margin-bottom: 5px;" />
                        <MudButton Style="width: 127px;" Class="btnsmallsapos" Variant="Variant.Filled" OnClick="@(() => AddNewRemark(obj.AssetCode, newRemark))">Add Remark</MudButton>
                    </div>
                </div>
                <div class="d-flex flex-wrap flex-grow-1">
                    <MudChipSet AllClosable="true" OnClose="CloseRemark">
                        @foreach (var item in REMARKS)
                        {
                            <MudChip Style="color: #fafaf5; background-color: #757a90;" Text="@item.Remark"></MudChip>
                        }
                    </MudChipSet>
                </div>
            </div>
        </div>
        <div class="d-flex justify-content-center">
            <button type="button" class="btn btn-save" @onclick="SaveUpdate">Save</button>
        </div>
    </div>
</MudDrawer>

<MudDrawer @bind-Open="@lastCheckOpen" Width="500px" Height="100%" Anchor="@anchor" Elevation="1" Variant="@DrawerVariant.Temporary" Style=" margin: 10px;">
    <div class="d-flex flex-column gap-2 drawerdetails">
        <span>Last Check On</span>
        <div class="flex-grow-1">
            <MudText Align="Align.Start" Style="color: #6A707D;" Typo="Typo.caption">Last Check On</MudText>

            <MudDatePicker Editable="true" @bind-Date="obj.LastCheckDate" Mask="@(new DateMask("MM/dd/yyyy"))" DateFormat="MM/dd/yyyy" Variant="Variant.Outlined" Margin="Margin.Dense" Style="margin-bottom: 5px;" />
        </div>
        <div class="d-flex justify-content-center">
            <button type="button" class="btn btn-save" @onclick="SaveUpdate">Save</button>
        </div>
    </div>
</MudDrawer>

<script>
    $(document).ready(function () {
        $(document).on('click', '.ellipsis-clickable', function () {
            var $this = $(this);
            var remarks = $this.data('remarks');
            var maxLength = $this.data('maxLength');
            var currentText = $this.text();

            if (currentText === remarks) {
                // Text is already full, truncate it
                $this.text(truncateString(remarks, maxLength));
            } else {
                // Text is truncated, display full remarks
                $this.text(remarks);
            }
        });

        function truncateString(value, maxLength) {
            return value.length <= maxLength ? value : value.substring(0, maxLength) + "...";
        }
    });

    $(document).ready(function () {
        $(document).on('click', '.textsss', function () {
            $('#myModal').css("display", "block");
            $('#myModal').css('z-index', 999999999);
            $('#img01').attr('src', $(this).parentsUntil("imgassetdiv").children(".imgasset").attr('src'));
            $('#caption').text($(this).parentsUntil("imgassetdiv").children(".imgasset").attr('alt'));
            $('#date').text($(this).parentsUntil("imgassetdiv").children(".imgasset").data("date"));
            $('#datetime').text($(this).parentsUntil("imgassetdiv").children(".imgasset").data("datetime"));
        });

        $(document).on('click', '.imgasset', function () {
            $('#myModal').css("display", "block");
            $('#myModal').css('z-index', 999999999);
            $('#img01').attr('src', $(this).attr('src'));
            $('#caption').text($(this).attr('alt'));
            $('#date').text($(this).data("date"));
            $('#datetime').text($(this).data("datetime"));
        });

        $(document).on('click', '#closemodalimg', function () {
            $('#myModal').css("display", "none");
        });

        $(document).keydown(function (event) {
            if (event.keyCode == 27) {
                $('#myModal').css("display", "none");
            }
        });
    });
</script>