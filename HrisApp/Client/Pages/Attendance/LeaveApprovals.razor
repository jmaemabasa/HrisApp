@page "/leaveApprovals"
@attribute [Authorize(Roles = "SysAdmin, GenAdmin, HR")]
<PageTitle>Leave Approvals</PageTitle>

<div class="mb-5">
    <div class="d-flex flex-row mt-5 justify-content-between align-items-center">
        <span style="font-size: x-large;font-weight: 600;color: #424242;">Leave Approvals</span>
        @*  <AuthorizeView Roles="HR, System Administrator">
        <Authorized>
        <MudButton OnClick="OpenAddLeave" Variant="Variant.Filled" Size="Size.Medium" StartIcon="@Icons.Material.Rounded.Add" Class="btnadd"> Leave Type</MudButton>
        </Authorized>
        </AuthorizeView> *@
    </div>
</div>

<div class="box w-auto">
    @if (leaveHistoryList == null || leaveHistoryList.Count == 0)
    {
        <MudProgressLinear Color="Color.Secondary" Indeterminate="true" Class="my-7" hidden="@isVisible" />

        <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="auto" hidden="@isVisible" />
        <MudCardContent hidden="@isVisible">
            <MudSkeleton Width="30%" Height="42px;" />
            <MudSkeleton Width="80%" />
            <MudSkeleton Width="100%" />
        </MudCardContent>
        <MudCardActions hidden="@isVisible">
            <MudSkeleton Width="64px" Height="40px" Class="ml-2" />
            <MudSkeleton Width="105px" Height="40px" Class="ml-3" />
        </MudCardActions>
        @if (isVisible == true)
        {
            <div class="divnodata">
                <MudImage Src="images/nodata.png" Alt="No Data" Width="332" Height="220" Class="rounded-lg" />
                <span class="nodataspan">No Data Available</span>
            </div>
        }
    }
    else
    {
        <MudTable Class="stable d-flex justify-content-between align-content-between flex-column h-100" Items="leaveHistoryList" Context="obj" SortLabel="Sort By" FixedHeader="true" Elevation="0" HorizontalScrollbar="true" Dense="true" Hover="true" Bordered="false" Striped="true" @bind-SelectedItem="selectedItem1">
            <HeaderContent>
                <MudTh Class="" Style="background: #e9ecef; font-weight: bold; font-size: 16px;">Employee</MudTh>
                <MudTh Class="" Style="background: #e9ecef; font-weight: bold; font-size: 16px;">Leave Type</MudTh>
                <MudTh Class="" Style="background: #e9ecef; font-weight: bold; font-size: 16px;">Duration</MudTh>
                <MudTh Class="" Style="background: #e9ecef; font-weight: bold; font-size: 16px;">No. of Days</MudTh>
                <MudTh Class="" Style="background: #e9ecef; font-weight: bold; font-size: 16px;">Status</MudTh>
                <MudTh Class="" Style="background: #e9ecef; font-weight: bold; font-size: 16px;">Action</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd Style="font-family: 'Poppins', sans-serif; font-weight: bold; color: #264487;" DataLabel="">
                    <EmployeeNameandAvatar verify="@obj.Verify_Id" />
                </MudTd>
                <MudTd Style="font-family: 'Poppins', sans-serif; font-weight: bold; color: #264487;" DataLabel="">@obj.LeaveType</MudTd>
                <MudTd Style="font-family: 'Poppins', sans-serif; color: #6A707D;" DataLabel="">@obj.From?.ToString("MMM dd") - @obj.To?.ToString("MMM dd")</MudTd>
                <MudTd Style="font-family: 'Poppins', sans-serif; color: #6A707D;" DataLabel="">@obj.NoOfDays Days</MudTd>
                <MudTd DataLabel="">
                    @if (@obj.Status == "Approved")
                    {
                        <MudChip Label="true" Style="font-family: 'Poppins', sans-serif; background-color: #C1D4CD; color: #397763;">@obj.Status <MudIcon Icon="@Icons.Material.Rounded.CheckCircle" Size="Size.Small" Style="margin-left: 2px" /></MudChip>
                    }
                    else if (@obj.Status == "Pending")
                    {
                        <MudChip Label="true" Style="font-family: 'Poppins', sans-serif; background-color: #D8D5E8; color: #7567B8;">@obj.Status <MudIcon Icon="@Icons.Material.Rounded.AccessTimeFilled" Size="Size.Small" Style="margin-left: 13px" /></MudChip>
                    }
                    else
                    {
                        <MudChip Label="true" Style="font-family: 'Poppins', sans-serif; background-color: #EABCBB; color: #BE1313;">@obj.Status <MudIcon Icon="@Icons.Material.Rounded.Cancel" Size="Size.Small" Style="margin-left: 9px" /></MudChip>
                    }

                </MudTd>
                <MudTd>
                    <AuthorizeView Roles="SysAdmin, GenAdmin, HR">
                        <Authorized>
                            <MudTooltip Text="View">
                                <MudIconButton Class="btnedit" OnClick="@(() => OpenViewLeaveDetails(obj.Id))" Icon="@Icons.Material.Rounded.Info" aria-label="Edit"></MudIconButton>
                            </MudTooltip>
                        </Authorized>
                        <NotAuthorized>
                            <MudIconButton Disabled Class="btnedit" Icon="@Icons.Material.Rounded.Info" aria-label="Edit"></MudIconButton>
                        </NotAuthorized>
                    </AuthorizeView>
                </MudTd>
            </RowTemplate>
            <PagerContent>
                <MudTablePager PageSizeOptions="new int[] { 10, 25, int.MaxValue }" InfoFormat="@($"Right {infoFormat}")" HorizontalAlignment="HorizontalAlignment.Right" />
            </PagerContent>
        </MudTable>
    }
</div>

<MudDialog @bind-IsVisible="visibleView" Options="dialogOptions">
    <DialogContent>
        <div class="d-flex flex-column">
            <div class="d-flex justify-content-between align-items-center" style="margin-bottom: 10px; margin-top:10px;">
                <span style="font-size: 16px; color: #424242"><b>Details</b></span>
                <MudTooltip Text="Close">
                    <MudIconButton Style="color: #BE1313; background-color: #EABCBB" OnClick="Cancel" Icon="@Icons.Material.Filled.Close" Size="Size.Small" aria-label="Edit"></MudIconButton>
                </MudTooltip>
            </div>

            <div class="divsingledetails mb-2">
                <MudText Align="Align.Start" Style="color: #FAFAF5;" Typo="Typo.caption">Leave Type</MudText>
                <MudText Align="Align.Start" Style="color: #FAFAF5; font-weight:bold;" Typo="Typo.body2">@obj.LeaveType</MudText>
            </div>
            <div class="d-flex gap-2 mb-2">
                <div class="divsingledetails flex-grow-1">
                    <MudText Align="Align.Start" Style="color: #FAFAF5;" Typo="Typo.caption">From</MudText>
                    <MudText Align="Align.Start" Style="color: #FAFAF5; font-weight:bold;" Typo="Typo.body2">@obj.From?.ToString("MMM dd, yyyy")</MudText>
                </div>
                <div class="divsingledetails flex-grow-1">
                    <MudText Align="Align.Start" Style="color: #FAFAF5;" Typo="Typo.caption">To</MudText>
                    <MudText Align="Align.Start" Style="color: #FAFAF5; font-weight:bold;" Typo="Typo.body2">@obj.To?.ToString("MMM dd, yyyy")</MudText>
                </div>
            </div>
            <div class="divsingledetails mb-2">
                <MudText Align="Align.Start" Style="color: #FAFAF5;" Typo="Typo.caption">No of Days</MudText>
                <MudText Align="Align.Start" Style="color: #FAFAF5; font-weight:bold;" Typo="Typo.body2">@obj.NoOfDays Days</MudText>
            </div>
            <div class="divsingledetails mb-2">
                <MudText Align="Align.Start" Style="color: #FAFAF5;" Typo="Typo.caption">Purpose</MudText>
                <MudText Align="Align.Start" Style="color: #FAFAF5; font-weight:bold;" Typo="Typo.body2">@obj.Purpose</MudText>
            </div>
            <AuthorizeView Roles="System Administrator">
                <Authorized>
                    <div class="divsingledetails mb-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <MudText Align="Align.Start" Style="color: #FAFAF5;" Typo="Typo.caption">Status</MudText>
                            @if (obj.Status == "Pending")
                            {
                                <MudTooltip Text="Update">
                                    <MudIconButton Style="color: #fafaf5" OnClick="OpenDropDownlist" hidden="@(isUpdateStatus ? true : false)" Icon="@Icons.Material.Rounded.Edit" Size="Size.Small" aria-label="Edit"></MudIconButton>
                                </MudTooltip>
                            }
                        </div>

                        @if (isUpdateStatus)
                        {
                            <div class="d-flex gap-2 align-items-center">
                                <div class="col col-8  flex-grow-1">
                                    <MudSelect Margin="Margin.Dense" T="string" @bind-Value="@obj.Status" Variant="Variant.Outlined" Class="selectLeaveStatus">
                                        <MudSelectItem Value="@("Approved")">Approve</MudSelectItem>
                                        <MudSelectItem Value="@("Pending")">Pending</MudSelectItem>
                                        <MudSelectItem Value="@("Rejected")">Reject</MudSelectItem>
                                    </MudSelect>
                                </div>
                                <div class="col col-4 flex-grow-1">
                                    <MudButton Variant="Variant.Filled" OnClick="@SaveUpdateStatus" DisableElevation Class="btnSaveStatus" Size="Size.Medium" FullWidth="true"><MudText>Save</MudText></MudButton>
                                </div>
                            </div>
                        }
                        else if (obj.Status == "Approved")
                        {
                            <MudText Align="Align.Start" Style="color: #C1D4CD; font-weight:bold;" Typo="Typo.body2">@obj.Status</MudText>
                        }
                        else if (obj.Status == "Pending")
                        {
                            <MudText Align="Align.Start" Style="color: #D8D5E8; font-weight:bold;" Typo="Typo.body2">@obj.Status</MudText>
                        }
                        else
                        {
                            <MudText Align="Align.Start" Style="color: #EABCBB; font-weight:bold;" Typo="Typo.body2">@obj.Status</MudText>
                        }
                    </div>
                </Authorized>
            </AuthorizeView>
        </div>
    </DialogContent>
</MudDialog>